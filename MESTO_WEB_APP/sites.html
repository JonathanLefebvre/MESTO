<!DOCTYPE html>
<html>
<head>
  <title>Manage Sites</title>
  <script src="libs/angular.min.js"></script>
  <script src="js/mestoHelper.js"></script>
  <script src="js/mestoApp.js"></script>
  <script src="js/siteCTL.js"></script>
  <link rel="stylesheet" type="text/css" href="ressources/css/mesto.css">
</head>
<body data-ng-app="MESTO" data-ng-controller="siteCTL">
	<h1>Add a Site</h1>
	<div >
		<div data-ng-show="siteForm.$dirty && siteForm.$invalid">
			<span class="error" data-ng-show="siteForm.reference.$error.required">Reference is required.</span>
			<span class="error" data-ng-show="siteForm.latitude.$error.required">Latitude is required.</span>
			<span class="error" data-ng-show="siteForm.latitude.$error.pattern">Invalid latitude format.</span>
			<span class="error" data-ng-show="siteForm.longitude.$error.required">Longitude is required.</span>
			<span class="error" data-ng-show="siteForm.longitude.$error.pattern">Invalid longitude format.</span>
			<span class="error" data-ng-show="siteForm.siteName.$error.required">Name is required.</span>
			<span class="error" data-ng-show="siteForm.postalCode.$error.pattern">Invalid postal code format.</span>
			<span class="error" data-ng-show="siteForm.startDate.$error.pattern">Invalid start date format.</span>
            <span class="error" data-ng-show="siteForm.endDate.$error.required">End date is required for temporary site.</span>
			<span class="error" data-ng-show="siteForm.endDate.$error.pattern">Invalid end date format.</span>
            <span class="error" data-ng-show="siteForm.endDate.$error.greaterThan">End date need to be greater than start date.</span>
		</div>
        <span class="error">{{SQLErrors}}</span>
        <span class="t">{{SQLMsgs}}</span>
		<form name="siteForm" novalidate >
			<input type="hidden" id="id" name="id" data-ng-model="site.id" />
			<div class="section">
				<div class="field"><label for="reference"># reference * :</label><input type="text" id="reference" name="reference" data-ng-model="site.reference" required /></div>
				<div class="field"><label for="latitude">latitude * (xx.xxxxxx):</label><input type="text" id="latitude" name="latitude" data-ng-model="site.latitude" required data-ng-pattern="/^[0-9][0-9]\.[0-9]{6}$/" /></div>
				<div class="field"><label for="longitude">longitude * (xx.xxxxxx):</label><input type="text" id="longitude" name="longitude" data-ng-model="site.longitude" required data-ng-pattern="/^[0-9][0-9]\.[0-9]{6}$/" /></div>
				<div class="field"><label for="siteName">Name * :</label><input type="text" id="siteName" name="siteName" data-ng-model="site.siteName" required /></div>
				<div class="field"><label for="description">description:</label><textarea cols="38" rows="5" id="description" name="description" data-ng-model="site.description"></textarea></div>
				<div class="field"><label for="isTemporary">Is temporary?</label>
                    <input type="checkbox" id="isTemporary" name="isTemporary" data-ng-checked="site.isTemporary == true" data-ng-model="site.isTemporary"/>
                </div>
				<div class="field"><label for="startDate">start date (dd-MM-yyyy):</label>
                    <input type="text" id="startDate" name="startDate" data-ng-model="site.startDate" data-ng-keyup="validEndDate()"
                        data-ng-pattern="/^(?:(?:31(\/|-|\.)(?:0?[13578]|1[02]))\1|(?:(?:29|30)(\/|-|\.)(?:0?[1,3-9]|1[0-2])\2))(?:(?:1[6-9]|[2-9]\d)?\d{2})$|^(?:29(\/|-|\.)(?:0?2|(?:Feb))\3(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:0?[1-9]|1\d|2[0-8])(\/|-|\.)(?:(?:0?[1-9])|(?:1[0-2]))\4(?:(?:1[6-9]|[2-9]\d)?\d{2})$/" />
                </div>
				<div class="field"><label for="endDate">end date (dd-MM-yyyy):</label>
                    <input type="text" id="endDate" name="endDate" data-ng-model="site.endDate" data-ng-required="site.isTemporary == true" data-ng-keyup="validEndDate()"
                        data-ng-pattern="/^(?:(?:31(\/|-|\.)(?:0?[13578]|1[02]))\1|(?:(?:29|30)(\/|-|\.)(?:0?[1,3-9]|1[0-2])\2))(?:(?:1[6-9]|[2-9]\d)?\d{2})$|^(?:29(\/|-|\.)(?:0?2|(?:Feb))\3(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:0?[1-9]|1\d|2[0-8])(\/|-|\.)(?:(?:0?[1-9])|(?:1[0-2]))\4(?:(?:1[6-9]|[2-9]\d)?\d{2})$/" />
                </div>
			</div>
			<div class="section2">
				<div class="field"><label for="address">Address:</label><input type="text" id="address" name="address" data-ng-model="site.address" /></div>
				<div class="field"><label for="city">City:</label><input type="text" id="city" name="city" data-ng-model="site.city" /></div>
				<div class="field"><label for="province">province:</label><input type="text" id="province" name="province" data-ng-model="site.province" /></div>
				<div class="field"><label for="country">country:</label><input type="text" id="country" name="country" data-ng-model="site.country" /></div>
				<div class="field"><label for="postalCode">postal code (X5X 5X5):</label><input type="text" id="postalCode" name="postalCode" data-ng-model="site.postalCode" data-ng-pattern="/^(?!.*[DFIOQU])[A-VXY][0-9][A-Z] [0-9][A-Z][0-9]$/" /></div>
                <div class="field"><label for="role">Role:</label><select id="role" ng-model="site.role" name="role" ng-options="role.value as role.label for role in ROLE"></select></div>
			</div>
		</form>
		<button data-ng-click="save();" ng-disabled="siteForm.$pristine || siteForm.$invalid">Save</button>
		<button data-ng-click="delete();" ng-disabled="!canDelete">Delete</button>
        <button data-ng-click="resetFrm();" ng-disabled="siteForm.$pristine">Reset</button>
	</div>
    
	<div>
        <h1>Sites List</h1>
        <span class="error" data-ng-show="lstError">{{lstError}}</span>
		<table border="1">
            <tr ><th>Reference</th><th>Name</th><th>Latitude</th><th>Longitude</th></tr>
			<tr data-ng-repeat="s in siteList" data-ng-click="loadSite(s)">
				<td>{{s.reference}}</td><td>{{s.siteName}}</td><td>{{s.latitude}}</td><td>{{s.longitude}}</td>
			</tr>
		</table>
	</div>
</body>
</html>